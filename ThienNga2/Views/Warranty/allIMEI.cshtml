
@using ThienNga2.Models.Entities;
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>WarrantyList</title>
    <script src="//code.jquery.com/jquery-1.12.3.js"> </script>
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"> </script>
    <script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"> </script>
    <script>
        $(document).ready(function () {
            $('#example').DataTable();
        });
    </script>


    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css" />
    <style>
        body {
            background: url('') no-repeat center center fixed;
        }
    </style>
</head>
<body>
    <div>
        <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>Ngày kích hoạt</th>
                    <th>Mã IMEI</th>
                    <th>Mã sản phẩm</th>
                    <th>Tên sản phẩm</th>
                    <th>Tên khách hàng</th>
                    <th>SDT khách hàng</th>
                    <th>Thời hạn</th>
                    <th>Miêu tả </th>
                
                    <th>Sữa</th>
                </tr>
            </thead>
            <tbody>
                @foreach (tb_warranty wact in (List<tb_warranty>)ViewData["allwar"])
                {
                    String dateID = wact.id + "date"; String warID = wact.id + "warID"; String SKUID = wact.id + "SKUID"; String NameID = wact.id + "NameID";
                    String DurationID = wact.id + "DurationID"; String DescriptionID = wact.id + "DescriptionID"; String phoneID = wact.id + "phoneID";



                    <tr>
                        <td id="@dateID">
                            @wact.startdate.ToShortDateString()
                        </td>
                        <td id="@warID">
                            @wact.warrantyID
                        </td>
                        <td id="@SKUID">
                            @wact.item.tb_product_detail.productStoreID
                        </td>
                        <td>
                            @wact.item.tb_product_detail.productName
                        </td>
                        <td id="@NameID">
                            @wact.item.tb_customer.customerName
                        </td>
                        <td id="@phoneID">
                            @wact.item.tb_customer.phonenumber
                        </td>
                        <td id="@DurationID">
                            @wact.duration
                        </td>
                        <td id="@DescriptionID">
                            @wact.description
                        </td>
                        <td>
                            <button type="button" value="@wact.id" onclick="startEdit(@wact.id)" class="btn blue" data-toggle="modal" data-target="#addmodel">Thay đổi</button>
                        </td>
                 
                       
                        
                    </tr>
                }

            </tbody>
        </table>
    </div>
    <div class="modal fade" id='addmodel' role="dialog">
        <div class="modal-dialog">

            <!-- Modal add content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Thay đổi thông tin mã bảo hành</h4>
                </div>
                <div class="modal-body">                      
                        <div class="form-style-10">
                            

                                <div class="section"><span></span>Thông tin sản phẩm</div>
                                <div class="inner-wrap">
                                    <input type="hidden" id="waID" value="" /><
                                    <label>Ngày kích hoạt:  <input type="text" id="newDate" value="" /></label>
                                    <label>IMEI:  <input type="text" id="newIMEI" value="" /></label>
                                    <label id="lidname">Tên sản phẩm  </label>
                                    <label id="lidgia">Giá:  </label>
                                    <label>SKU:  <input type="text" id="newSKU" value="" /></label>
                                    <label>Tên khách:  <input type="text" id="newName" value="" /></label>
                                    <label>SDT:  <input type="text" id="newSDT" value="" /></label>
                                    <label>Thời hạn:  <input type="text" id="newDuration" value="" /></label>
                                    <label>Miêu tả:  <input type="text" id="newDescription" value="" /></label>


                                </div>
                                <div class="button-section">
                                    <button id="btnSend" onclick="finishEdit()">Sửa</button>

                                </div>
                          
                        </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                </div>
            </div>


        </div>
    </div>
    <script>
        function startEdit(id){
            $("#waID").val(id);
            $("#newDate").val($("#" + id + "date").text().trim());
            $("#newIMEI").val($("#" + id + "warID").text().trim());
            $("#newSKU").val($("#" + id + "SKUID").text().trim());
            $("#newName").val($("#" + id + "NameID").text().trim());
            $("#newSDT").val($("#" + id + "phoneID").text().trim()); 
            $("#newDuration").val($("#" + id + "DurationID").text().trim()); 
            $("#newDescription").val($("#" + id + "DescriptionID").text().trim()); 
          
        }
        function finishEdit() {
            var newvalues = "?wactID=" + $("#waID").val() +"&newDate=" + $("#newDate").val() + "&newIMEI=" + $("#newIMEI").val() + "&newSKU=" + $("#newSKU").val() + "&newName=" + $("#newName").val() + "&newSDT=" + $("#newSDT").val() + "&newDuration=" + $("#newDuration").val() + "&newDescription=" + $("#newDescription").val();
     
            $.getJSON("/Warranty/updateWAR" + newvalues, function (result) {
               
                $.each(result, function (name, value) {
             
                    if (name == "name") {
                        if (value == "succeed") {
                            alert("Da sua xong");
                            $("#" + $("#waID").val() + "date").text($("#newDate").val());
                            $("#" + $("#waID").val() + "warID").text($("#newIMEI").val());
                            $("#" + $("#waID").val() + "SKUID").text($("#newSKU").val());
                            $("#" + $("#waID").val() + "NameID").text($("#newName").val());
                            $("#" + $("#waID").val() + "DurationID").text($("#newDuration").val()); 
                            $("#" + $("#waID").val() + "DescriptionID").text($("#newDescription").val()); 
                            ($("#" + $("#waID").val() + "phoneID").text($("#newSDT").val)); 
                        }
                        else {
                            $("#newDate").val($("#" + id + "date").text().trim());
                            $("#newIMEI").val($("#" + id + "warID").text().trim());
                            $("#newSKU").val($("#" + id + "SKUID").text().trim());
                            $("#newName").val($("#" + id + "NameID").text().trim());
                            $("#newSDT").val($("#" + id + "phoneID").text().trim());
                            $("#newDuration").val($("#" + id + "DurationID").text().trim());
                            $("#newDescription").val($("#" + id + "DescriptionID").text().trim());
                        }
                    }
                });

            });
        }
        var currentsku = "";
        function checkPrice() {
            var name = $("#newSKU").val();

            if (currentsku != name) {
            var flag = false;
            currentsku = name;
                $.getJSON("/ProductItem/getAllData?name=" + name, function (result) {

                    $.each(result, function (name, value) {
                        if (name == "name") {
                            flag = true;

                            if (value != null) {
                                $('#newSKU').css("background-color", "green");
                                $('#newSKU').css("color", "white");
                                $("#lidname").empty();
                                $("#lidname").append(value);
                            }


                        }
                        if (name == "price") {
                            if (flag && value != null) {
                                $("#pid" + (index - 1)).text(numberWithCommas(value));
                                $('#lidgia').val(numberWithCommas(value));
                            }
                        }
                    })
                });
            
            if (!flag) {
                $('#newSKU').css("background-color", "orange");
          
                $('#newSKU').css("color", "white");
            }
            }
        };
        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        setInterval(checkPrice, 100);
    </script>
</body>
</html>
